<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</head>
<body>
    <form action="#" class="form-inline" method="POST" onsubmit="expenseDetails(event)">
        <div class="form-control">
            <label for="expenseamount" class="form-label">Choose Expense Amount</label>
            <input type="text" id="expenseamount" class="form-control">
        </div>
        <div class="form-control">
            <label for="description" class="form-label">Choose Description</label>
            <input type="text" id="description" class="form-control">
        </div>
        <div class="form-control">
            <label for="category" class="form-label">Choose a Category</label>
            <select id="category" class="form-select">
                <option value="Fuel">Fuel</option>
                <option value="Food">Food</option>
                <option value="Electricity">Electricity</option>
                <option value="Movie">Movie</option>
            </select>
        </div>
        <button class="btn btn-dark" type="submit">Add Expense</button>
    </form>

    <ul id="listOfExpenses"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

    <script>
        function expenseDetails(event) {
            event.preventDefault();
            const expenseamount = event.target.expenseamount.value;
            const description = event.target.description.value;
            const category = event.target.category.value;
            const obj = {
                expenseamount,
                description,
                category
            }
            axios.post("http://localhost:3000/expense/addexpense", obj)
            .then(response => {
                displayExpenses(response.data.expenses);
            })
            .catch(err => {
                document.body.innerHTML = document.body.innerHTML + `<div>${err.message}<div>`
                console.log(err)
            })
        }

        window.addEventListener("DOMContentLoaded", () => {
            axios.get("http://localhost:3000/expense/getexpense")
            .then((response) => {
                for(var i = 0; i < response.data.expenses.length; i++) {
                    displayExpenses(response.data.expenses[i]);
                }
            })
            .catch(error => {
                console.log(error)
            })
        })

        function displayExpenses(obj) {
            // console.log(obj);
            const parentNode = document.getElementById('listOfExpenses');
            const childNode = document.createElement('li');
            childNode.textContent = obj.expenseamount + '-' + obj.description + '-' + obj.category;
            const delBtn = document.createElement('input');
            delBtn.type = 'button';
            delBtn.value = 'Delete Expense';
            delBtn.onclick = () => {
                parentNode.removeChild(childNode)
                axios.delete(`http://localhost:3000/expense/deleteexpense/${obj.id}`)
                .then(response => {
                    console.log(response);
                })
                .catch(err => {
                    console.log(err);
                })
            }
            childNode.appendChild(delBtn);
            parentNode.appendChild(childNode);
        }
    </script>
</body>
</html>